<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>TwoPaneJSTest</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="main.css">
    <style type="text/css">

      #pane2wrap {
        margin-left:100px;
        padding-left:50px;
      }

      .TwoPaneJSContent {
        position:relative;
        width:inherit;
        height:inherit;
        cursor:grab;
      }

      .TwoPaneJSContent.panning  {
        cursor:grabbing;
      }

      .TwoPaneJSDivider  {
        position:absolute;
        z-index:4;
        background:white;
        opacity: .5;
        width:10px;
        height:inherit;
        cursor:ew-resize;
      }

      .TwoPaneJSPane  {
        position:absolute;
        top:0px;
        overflow:hidden;
      }

      .TwoPaneJSPane1  {
        z-index:2;
        left:0px;
      }

      .TwoPaneJSPane2  {
        z-index:3;
        right:0px;
      }

      .TwoPaneJSPane>*  {
        position:absolute;
      }

    </style>
  </head>
  <body>

    <h1>TwoPaneJS Test</h1>

    <div id="pane2wrap">
      <div class="TwoPaneJS">
        <div class="TwoPaneJSDivider"></div>
        <div class="TwoPaneJSContent">
          <div class="TwoPaneJSPane TwoPaneJSPane1"><img src="3280152297_25f8dc6179_z_lo.jpg" /></div>
          <div class="TwoPaneJSPane TwoPaneJSPane2"><img src="3280152297_25f8dc6179_z_hi.jpg" /></div>
        </div>
      </div>
        <label><span>Zoom:</span><input id="zoomSlider" type="range" value="2" min="1" max="3" step=".01" /></label>
    </div>

    <p>Photo credit: <a href="https://www.flickr.com/photos/torek/3280152297/">kirainet</a> via <a href="https://visualhunt.com/">Visual hunt</a> / <a href="http://creativecommons.org/licenses/by-nd/2.0/">CC BY-ND</a></p>

    <script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>
    <script>window.jQuery || document.write('<script src="jquery-2.2.2.min.js"><\/script>')</script>
    <script>

      function dividerOnMouseDown(e)  {
        e.preventDefault(); //  stop browser from trying to interpret this click and drag as a text selection
        $('.TwoPaneJSDivider').addClass('dragging');
        $(window).on('mousemove',globalOnMouseMove)
        $(window).on('mouseup',globalOnMouseUp);
        return false;
      }

      function contentPaneOnMouseDown(e)  {
        e.preventDefault(); //  stoppit browser
        $('.TwoPaneJSContent').addClass('panning').data('grabOffset',{
          /*
          'x':parseInt(e.pageX - ($('.TwoPaneJSContent').offset().left * $('#zoomSlider')[0].value)),
          'y':parseInt(e.pageY - ($('.TwoPaneJSContent').offset().top * $('#zoomSlider')[0].value))
          */
          'x':e.pageX - parseInt($('.TwoPaneJSPane>*').css('left')),
          'y':e.pageY - parseInt($('.TwoPaneJSPane>*').css('top'))
        });
        $(window).on('mousemove',globalOnMouseMove)
        $(window).on('mouseup',globalOnMouseUp);
        return false;
      }

      function globalOnMouseMove(e) {

          //  make the math happen

        if($('.TwoPaneJSDivider').hasClass('dragging')){  //  if the divider is dragging
          setDivider(getPaneCoordsFromMouse(e.pageX));
        }else if($('.TwoPaneJSContent').hasClass('panning')){ //  if the content is panning
          var panCoords = getPanCoordsFromMouse(e.pageX, e.pageY);
          setContentPan(panCoords.x,panCoords.y);
        }
      }

      function getPaneCoordsFromMouse(mousePageX) {
        var containerOffset = $('.TwoPaneJSContent').offset().left;
        var containerMousPos = parseInt(mousePageX - containerOffset);
        var lowBound = 0;
        var highBound = $('.TwoPaneJSContent').width() - $('.TwoPaneJSDivider').width();
        var dividerPos = Math.min(Math.max(containerMousPos,lowBound),highBound);

        return dividerPos;
      }

      function getPanCoordsFromMouse(mousePageX,mousePageY)  {

          //  taking stock

        var contWidth = $('.TwoPaneJSContent').width()
        var contHeight = $('.TwoPaneJSContent').height();

        var contentScaledWidth = $('.TwoPaneJSPane').width() * $('#zoomSlider')[0].value;
        var contentScaledHeight = $('.TwoPaneJSPane').height() * $('#zoomSlider')[0].value;

          //  go cardinals

        var nBound = Math.floor((contHeight - contentScaledHeight) / 2);
        var sBound = -nBound;

        var wBound = Math.floor((contWidth - contentScaledWidth) / 2);
        var eBound = -wBound;

          //  if you give a mouse an offset

        var contMouseX = mousePageX - $('.TwoPaneJSContent').data('grabOffset').x;
        var contMouseY = mousePageY - $('.TwoPaneJSContent').data('grabOffset').y;

        var xOffset = Math.max(Math.min(contMouseX,eBound),wBound);
        var yOffset = Math.max(Math.min(contMouseY,sBound),nBound);

        return {
          'x':xOffset,
          'y':yOffset
        }
      }

      function globalOnMouseUp(e) {

        $('.TwoPaneJSDivider').removeClass('dragging');
        $('.TwoPaneJSContent').removeClass('panning');

        $(this).off('mouseup',globalOnMouseUp).off('mousemove',globalOnMouseMove);
      }

      function setDivider(dividerPos){
        var rightSize = $('.TwoPaneJSContent').width() - dividerPos;
        var leftSize = $('.TwoPaneJSContent').width() - leftSize;

        $('.TwoPaneJSDivider').css({'margin-left':dividerPos});
        $('.TwoPaneJSPane1').css({'width':leftSize});
        $('.TwoPaneJSPane2').css({'width':rightSize,'margin-left':dividerPos}).children().css({'margin-left':-dividerPos});
      }

      function sliderOnChange(e)  { zoomTo(e.target.value); }

      function zoomTo(scaleFactor)  {
        $('.TwoPaneJSPane>*').css({'transform':'scale('+scaleFactor+', '+scaleFactor+')'});
        setContentPan(parseInt($('.TwoPaneJSPane>*').css('left')),parseInt($('.TwoPaneJSPane>*').css('top')));
      }

      function setContentPan(left, top) { $('.TwoPaneJSPane>*').css({'left':left, 'top':top});  }

      $(function(){

            //  size2start

        $('.TwoPaneJS,.TwoPaneJSPane').width($('.TwoPaneJSPane>*').width());
        $('.TwoPaneJS,.TwoPaneJSPane').height($('.TwoPaneJSPane>*').height());

            //  drag2compare

        $('.TwoPaneJSDivider')
          .css({'margin-left':(parseInt($('.TwoPaneJSContent').width()/2) - ($('.TwoPaneJSDivider').width()/2))})
          .data({'isDragging':false})
          .on('mousedown',dividerOnMouseDown);
        setDivider($('.TwoPaneJS').width()/2);

            //  slide2zoom

          $('#zoomSlider').on('change input', sliderOnChange);
          zoomTo($('#zoomSlider')[0].value);

            //  drag2pan

          $('.TwoPaneJSPane').on('mousedown', contentPaneOnMouseDown);
      })
    </script>
  </body>
</html>
